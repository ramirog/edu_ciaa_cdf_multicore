

#include "helper.h"
#include "chip.h"
#include "dac_18xx_43xx.h"
#include "gpio_18xx_43xx.h"

volatile uint32_t msTicks = 0;
uint8_t i = 0;

void SysTick_Handler(void) {
    msTicks++;
    i++;
    if (i > 20)
    	i = 0;
    Chip_DAC_UpdateValue(LPC_DAC, i*50);
}

void blink_if_time(uint8_t PinId) {
	if (msTicks > 100000) {
		blink(PIN_ID1);
		msTicks = 0;
	}
}

//uint32_t sinetable[]={512,528,544,560,576,592,608,624,639,655,670,685,700,715,730,744,759,773,786,800,813,826,838,850,862,874,885,896,906,916,926,935,944,953,961,968,975,982,988,994,999,1004,1008,1012,1015,1018,1020,1022,1022,1023,1023,1023,1022,1022,1020,1018,1015,1012,1008,1004,999,994,988,982,975,968,961,953,945,936,927,917,907,896,886,874,863,851,839,826,813,800,787,773,759,745,731,716,701,686,671,656,640,624,609,593,577,561,545,529,513,497,481,465,449,433,417,401,386,370,355,339,324,310,295,280,266,252,238,225,212,199,186,174,162,151,139,129,118,108,98,89,80,72,64,56,49,43,36,31,25,21,16,13,9,6,4,2,1,0,0,0,1,2,4,6,9,12,16,20,25,30,35,42,48,55,63,71,79,88,97,107,117,127,138,149,160,172,185,197,210,223,236,250,264,278,293,307,322,337,352,368,383,399,415,430,446,462,478,494};

int main(void)
{
	init_dac();
	init_blink(PIN_ID1);
	init_systick(100000); // A sample every 10 us.

    while(1)
	{
    	blink_if_time(PIN_ID1);
	}
}


